<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - MASKRIDER SHOP</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="amazon-header">
        <a href="Html.html" class="logo">MASKRIDER SHOP</a>

        <div class="search-bar">
            <select>
                <option>‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                <option>‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå</option>
                <option>‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤</option>
                <option>‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</option>
                <option>‡∏ö‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏ß‡∏ô</option>
            </select>
            <input type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...">
            <button>üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
        </div>

        <div class="header-links">
            <a id="accountLink" href="login.html">üë§ ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</a>
            <a id="logoutLink" href="#" style="display:none;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
            <a href="Html.html">üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
            <a href="favorites.html">‚ù§Ô∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î (<span id="favoritesCount">0</span>)</a>
            <a id="adminLink" class="admin-link" href="#" onclick="toggleAdmin()">üîê Admin<span id="adminBadge" class="admin-badge" style="display:none;">ON</span></a>
        </div>
    </header>

    <nav>
        <ul class="head-menu">
            <li><a href="Html.html">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a></li>
            <li><a href="about.html">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</a></li>
            <li><a href="services.html">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</a></li>
            <li><a href="contact.html">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</a></li>
        </ul>
    </nav>

    <main class="product-detail-page">
        <div class="product-detail-topbar">
            <button class="back-btn" type="button" onclick="goBack()">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        </div>

        <section class="product-detail" aria-live="polite">
            <div class="product-detail-media">
                <div class="product-detail-image" id="detailImageWrap">
                    <img id="detailImage" src="" alt="">
                </div>

                <div class="product-detail-video" id="detailVideoWrap" style="display: none;">
                    <video id="detailVideo" controls playsinline>
                        <source id="detailVideoSource" src="" type="video/mp4">
                    </video>
                </div>
            </div>

            <div class="product-detail-info">
                <h1 id="detailTitle" class="product-detail-title"></h1>
                <div id="detailPrice" class="product-detail-price"></div>
                <div id="detailStock" class="product-stock"></div>
                <div id="detailAdminRestock" class="admin-restock">
                    <span class="admin-restock-label">‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏ï‡πä‡∏≠‡∏Å (‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô)</span>
                    <div class="admin-restock-row">
                        <input id="restockInput" class="admin-restock-input" type="number" min="1" step="1" value="1" inputmode="numeric">
                        <button class="admin-restock-btn" type="button" onclick="restockCurrentProduct()">‡πÄ‡∏ï‡∏¥‡∏°</button>
                    </div>
                </div>
                <div id="detailDescription" class="product-detail-desc"></div>

                <div class="product-detail-actions">
                    <button class="buy-button" type="button" onclick="goBack()">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                </div>
            </div>
        </section>

        <section class="product-review" id="reviewSection" style="display: none;">
            <h2 class="product-review-title">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>

            <form id="reviewForm" class="review-form">
                <div class="review-field">
                    <label for="reviewName">‡∏ä‡∏∑‡πà‡∏≠</label>
                    <input id="reviewName" name="name" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" required>
                </div>

                <div class="review-field">
                    <label for="reviewText">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</label>
                    <textarea id="reviewText" name="text" rows="4" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠..." required></textarea>
                </div>

                <button class="checkout-btn" type="submit">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</button>
                <div id="reviewStatus" class="review-status"></div>
            </form>

            <div id="reviewList" class="review-list"></div>
        </section>

        <section class="product-detail-notfound" id="notFound" style="display: none;">
            <h2>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
            <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</p>
            <button class="back-btn" type="button" onclick="location.href='Html.html'">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
        </section>
    </main>

    <script src="auth.js"></script>
    <script src="favorites.js"></script>
    <script>
        const productData = {
            'bandai-kamen-rider-gavv-dx-gavv-driver': {
                title: 'Bandai Kamen Rider Gavv DX Gavv Driver Henshin Belt',
                price: '‡∏ø1,200',
                image: 's-l1200.jpg',
                video: 'video/gavv.mp4',
                description: '‡πÄ‡∏Ç‡πá‡∏°‡∏Ç‡∏±‡∏î‡πÅ‡∏õ‡∏•‡∏á‡∏£‡πà‡∏≤‡∏á‡∏£‡∏∏‡πà‡∏ô DX ‡∏à‡∏≤‡∏Å MASKRIDER ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏±‡∏™‡∏î‡∏∏ ‡∏Ç‡∏ô‡∏≤‡∏î ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á'
            },
            'kamen-rider-wizard-mini-driver': {
                title: 'Kamen Rider Wizard Mini Wizard Driver Belt',
                price: '‡∏ø550',
                image: 's-l1200 (1).jpg',
                video: 'video/videoplayback.mp4',
                description: '‡πÄ‡∏Ç‡πá‡∏°‡∏Ç‡∏±‡∏î‡πÅ‡∏õ‡∏•‡∏á‡∏£‡πà‡∏≤‡∏á‡∏£‡∏∏‡πà‡∏ô Mini ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Kamen Rider Wizard ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£'
            },
            'Kamen Rider Build / DX Build Driver': {
                title: 'Kamen Rider Build / DX Build Driver',
                price: '‡∏ø1,500',
                image: 'th-11134207-81zto-mhim18g3z9xfd4.jfif',
                video: 'video/[Omamori][Lyrics + Engsub] Be The One - PANDORA - Kamen Rider Build Opening.mp4',
                description: '‡πÄ‡∏Ç‡πá‡∏°‡∏Ç‡∏±‡∏î DX Build Driver ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£'
            },
            'HENSHIN BELT DX ZEZTZ DRIVER': {
                title: 'HENSHIN BELT DX ZEZTZ DRIVER',
                price: '‡∏ø2,300',
                image: '37990_300x300_nocrop.jpg',
                video: 'video/zezt.mp4',
                description: '‡πÄ‡∏Ç‡πá‡∏°‡∏Ç‡∏±‡∏î DX ZEZTZ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£'
            },
            'samsung-galaxy-s24-ultra': {
                title: 'Samsung Galaxy S24 Ultra',
                price: '‡∏ø34,999',
                image: 'https://via.placeholder.com/800x600/4CAF50/FFFFFF?text=Samsung+Galaxy+S24',
                video: 'video/bg.mp4',
                description: '‡∏™‡∏°‡∏≤‡∏£‡πå‡∏ó‡πÇ‡∏ü‡∏ô‡πÄ‡∏£‡∏∑‡∏≠‡∏ò‡∏á ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£'
            },
            'dell-xps-15': {
                title: 'Dell XPS 15',
                price: '‡∏ø52,999',
                image: 'https://via.placeholder.com/800x600/2196F3/FFFFFF?text=Dell+XPS+15',
                video: 'video/bg.mp4',
                description: '‡πÇ‡∏ô‡πâ‡∏ï‡∏ö‡∏∏‡πä‡∏Å‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏° ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£'
            },
            'sony-wh-1000xm5': {
                title: 'Sony WH-1000XM5',
                price: '‡∏ø12,999',
                image: 'https://via.placeholder.com/800x600/FF9800/FFFFFF?text=Sony+WH-1000XM5',
                video: 'video/bg.mp4',
                description: '‡∏´‡∏π‡∏ü‡∏±‡∏á‡∏ï‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏£‡∏ö‡∏Å‡∏ß‡∏ô ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£'
            },
            'garmin-fenix-7': {
                title: 'Garmin Fenix 7',
                price: '‡∏ø18,999',
                image: 'https://via.placeholder.com/800x600/9C27B0/FFFFFF?text=Garmin+Fenix+7',
                video: 'video/bg.mp4',
                description: '‡∏™‡∏°‡∏≤‡∏£‡πå‡∏ó‡∏ß‡∏≠‡∏ó‡∏ä‡πå‡∏™‡∏≤‡∏¢‡∏Å‡∏µ‡∏¨‡∏≤ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£'
            },
            'canon-eos-r6': {
                title: 'Canon EOS R6',
                price: '‡∏ø58,999',
                image: 'https://via.placeholder.com/800x600/F44336/FFFFFF?text=Canon+EOS+R6',
                video: 'video/bg.mp4',
                description: '‡∏Å‡∏•‡πâ‡∏≠‡∏á Mirrorless ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£'
            },
            'xbox-series-x': {
                title: 'Xbox Series X',
                price: '‡∏ø14,999',
                image: 'https://via.placeholder.com/800x600/00BCD4/FFFFFF?text=Xbox+Series+X',
                video: 'video/bg.mp4',
                description: '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏ã‡∏• ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£'
            },
            'lg-ultragear-27': {
                title: 'LG UltraGear 27"',
                price: '‡∏ø9,999',
                image: 'https://via.placeholder.com/800x600/795548/FFFFFF?text=LG+UltraGear+27',
                video: 'video/bg.mp4',
                description: '‡∏à‡∏≠‡πÄ‡∏Å‡∏°‡∏°‡∏¥‡πà‡∏á ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£'
            },
            'keychron-k2': {
                title: 'Keychron K2',
                price: '‡∏ø2,999',
                image: 'https://via.placeholder.com/800x600/607D8B/FFFFFF?text=Keychron+K2',
                video: 'video/bg.mp4',
                description: '‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î Mechanical ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£'
            }
        };

        const stockDefaults = {
            'bandai-kamen-rider-gavv-dx-gavv-driver': 5,
            'kamen-rider-wizard-mini-driver': 5,
            'Kamen Rider Build / DX Build Driver': 5,
            'HENSHIN BELT DX ZEZTZ DRIVER': 5,
            'sony-a7-iv': 2,
            'playstation-5': 3
        };

        function getStockKey(productId) {
            return 'stock:' + productId;
        }

        function ensureStockInitialized(productId) {
            const key = getStockKey(productId);
            const existing = localStorage.getItem(key);
            if (existing !== null) return;
            const initial = Object.prototype.hasOwnProperty.call(stockDefaults, productId) ? stockDefaults[productId] : 10;
            localStorage.setItem(key, String(initial));
        }

        function getStock(productId) {
            ensureStockInitialized(productId);
            const raw = localStorage.getItem(getStockKey(productId));
            const num = parseInt(raw || '0', 10);
            return Number.isFinite(num) ? Math.max(0, num) : 0;
        }

        function setStock(productId, value) {
            localStorage.setItem(getStockKey(productId), String(Math.max(0, value)));
        }

        const ADMIN_SESSION_KEY = 'admin:isLoggedIn';

        function isAdmin() {
            return localStorage.getItem(ADMIN_SESSION_KEY) === '1';
        }

        function setAdmin(value) {
            localStorage.setItem(ADMIN_SESSION_KEY, value ? '1' : '0');
        }

        function updateAdminUI() {
            const badge = document.getElementById('adminBadge');
            if (badge) badge.style.display = isAdmin() ? 'inline-block' : 'none';

            const restockEl = document.getElementById('detailAdminRestock');
            if (restockEl) restockEl.style.display = isAdmin() ? 'block' : 'none';
        }

        function toggleAdmin() {
            if (isAdmin()) {
                const ok = confirm('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô?');
                if (!ok) return;
                setAdmin(false);
                updateAdminUI();
                return;
            }

            if (!window.auth || !window.auth.isAdminUser || !window.auth.isAdminUser()) {
                alert('‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
                return;
            }

            const pass = prompt('‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô admin');
            if (pass === null) return;
            if (window.auth.verifyCurrentUserPassword && window.auth.verifyCurrentUserPassword(String(pass))) {
                setAdmin(true);
                updateAdminUI();
                alert('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
            } else {
                alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
            }
        }

        function updateStockDisplay(productId) {
            const stockEl = document.getElementById('detailStock');
            if (!stockEl) return;
            const stock = getStock(productId);
            if (stock <= 0) {
                stockEl.textContent = 'Sold Out';
                stockEl.classList.add('is-soldout');
            } else {
                stockEl.textContent = '‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ' + stock;
                stockEl.classList.remove('is-soldout');
            }
        }

        function restockCurrentProduct() {
            if (!isAdmin()) {
                alert('‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
                return;
            }

            const productId = getProductId();
            if (!productId) return;
            const input = document.getElementById('restockInput');
            const add = parseInt((input && input.value) ? input.value : '0', 10);
            if (!Number.isFinite(add) || add <= 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                return;
            }

            const current = getStock(productId);
            setStock(productId, current + add);
            updateStockDisplay(productId);
            alert('‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏ï‡πä‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        }

        function goBack() {
            if (history.length > 1) {
                history.back();
                return;
            }
            location.href = 'Html.html';
        }

        function escapeHtml(str) {
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        function getProductId() {
            const params = new URLSearchParams(location.search);
            return params.get('id') || '';
        }

        function getReviewKey(productId) {
            return 'reviews:' + productId;
        }

        function loadReviews(productId) {
            try {
                const raw = localStorage.getItem(getReviewKey(productId));
                const arr = raw ? JSON.parse(raw) : [];
                return Array.isArray(arr) ? arr : [];
            } catch {
                return [];
            }
        }

        function saveReviews(productId, reviews) {
            localStorage.setItem(getReviewKey(productId), JSON.stringify(reviews));
        }

        function renderReviews(productId) {
            const listEl = document.getElementById('reviewList');
            if (!listEl) return;

            const reviews = loadReviews(productId);
            if (reviews.length === 0) {
                listEl.innerHTML = '<div class="review-empty">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</div>';
                return;
            }

            listEl.innerHTML = reviews
                .slice()
                .reverse()
                .map(r => {
                    return (
                        '<div class="review-item">' +
                        '<div class="review-meta">' +
                        '<strong>' + escapeHtml(r.name) + '</strong>' +
                        '<span>' + escapeHtml(r.date) + '</span>' +
                        '</div>' +
                        '<div class="review-text">' + escapeHtml(r.text) + '</div>' +
                        '</div>'
                    );
                })
                .join('');
        }

        function setStatus(message, type) {
            const el = document.getElementById('reviewStatus');
            if (!el) return;
            el.textContent = message || '';
            el.style.color = type === 'success' ? '#2e7d32' : type === 'error' ? '#c62828' : '#333';
        }

        function initPage() {
            const productId = getProductId();
            const product = productData[productId];

            const detailSection = document.querySelector('.product-detail');
            const notFound = document.getElementById('notFound');
            const reviewSection = document.getElementById('reviewSection');

            if (!product) {
                if (detailSection) detailSection.style.display = 'none';
                if (reviewSection) reviewSection.style.display = 'none';
                if (notFound) notFound.style.display = 'block';
                return;
            }

            document.getElementById('detailTitle').textContent = product.title;
            document.getElementById('detailPrice').textContent = product.price;
            document.getElementById('detailDescription').textContent = product.description;

            updateStockDisplay(productId);
            updateAdminUI();

            const imgEl = document.getElementById('detailImage');
            imgEl.src = product.image;
            imgEl.alt = product.title;

            const videoWrap = document.getElementById('detailVideoWrap');
            const videoEl = document.getElementById('detailVideo');
            const videoSourceEl = document.getElementById('detailVideoSource');

            if (product.video) {
                videoSourceEl.src = product.video;
                videoEl.load();
                videoWrap.style.display = 'block';
            }

            if (reviewSection) reviewSection.style.display = 'block';
            renderReviews(productId);

            const form = document.getElementById('reviewForm');
            form.addEventListener('submit', function (e) {
                e.preventDefault();

                const name = String(document.getElementById('reviewName').value || '').trim();
                const text = String(document.getElementById('reviewText').value || '').trim();

                if (!name || !text) {
                    setStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö', 'error');
                    return;
                }

                const reviews = loadReviews(productId);
                reviews.push({
                    name,
                    text,
                    date: new Date().toLocaleString()
                });

                saveReviews(productId, reviews);
                form.reset();
                setStatus('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                renderReviews(productId);

                setTimeout(() => {
                    setStatus('', 'info');
                }, 2000);
            });
        }

        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>
